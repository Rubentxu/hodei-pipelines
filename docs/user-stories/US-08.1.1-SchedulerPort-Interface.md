# US-08.1.1: SchedulerPort Interface Creation

## ðŸ“‹ User Story Details

**Story ID**: US-08.1.1  
**Epic**: [EPIC-08: Resource Pool Architecture](./EPIC-08-Resource_Pool_Architecture_Implementation_Plan.md)  
**Sub-EPIC**: 08.1: Auto-Registration System  
**Priority**: P0 (Critical)  
**Sprint**: 1 (Week 1)  
**Story Points**: 3  

---

## ðŸŽ¯ Story

### As a
System Architect

### I want to
Define a clean interface (SchedulerPort) for registering workers in the Scheduler

### So that
WorkerManagementService can integrate with Scheduler without depending on concrete implementation

---

## ðŸ“ Acceptance Criteria

### AC-01: Port Interface Definition
```rust
#[async_trait]
pub trait SchedulerPort: Send + Sync {
    /// Register a dynamically provisioned worker
    async fn register_worker(&self, worker: Worker) -> Result<(), SchedulerError>;
    
    /// Unregister a worker (e.g., when stopping/deleting)
    async fn unregister_worker(&self, worker_id: &WorkerId) -> Result<(), SchedulerError>;
    
    /// Get list of registered workers
    async fn get_registered_workers(&self) -> Result<Vec<WorkerId>, SchedulerError>;
}
```

**Verification**:
- [ ] Port defined in `hodei-ports/src/scheduler_port.rs`
- [ ] Uses `async_trait` attribute
- [ ] All methods documented with KDoc
- [ ] Error type defined as `SchedulerError`

### AC-02: Error Handling
```rust
#[derive(thiserror::Error, Debug)]
pub enum SchedulerError {
    #[error("Registration failed: {0}")]
    RegistrationFailed(String),
    
    #[error("Worker not found: {0}")]
    WorkerNotFound(WorkerId),
    
    #[error("Internal error: {0}")]
    Internal(String),
}
```

**Verification**:
- [ ] `SchedulerError` enum defined
- [ ] Uses `thiserror` for boilerplate reduction
- [ ] Implements `std::error::Error` trait
- [ ] All error variants documented

### AC-03: Async Trait Support
- [ ] Port uses `#[async_trait]` macro
- [ ] All async methods have proper Send + Sync bounds
- [ ] Compatible with `Box<dyn SchedulerPort>`

### AC-04: Documentation
- [ ] KDoc for port interface explaining purpose
- [ ] KDoc for each method with parameters and return types
- [ ] Example usage in documentation comments

---

## ðŸ”§ Technical Implementation

### File: `crates/ports/src/scheduler_port.rs`

```rust
//! Scheduler Port
//!
//! This module defines the port (trait) for integrating worker management
//! with the scheduler system. This enables decoupled registration of
//! dynamically provisioned workers without depending on concrete scheduler
//! implementations.

use async_trait::async_trait;
use hodei_core::{Worker, WorkerId};

/// Scheduler port error
#[derive(thiserror::Error, Debug)]
#[error("Scheduler error: {0}")]
pub enum SchedulerError {
    #[error("Registration failed: {0}")]
    RegistrationFailed(String),

    #[error("Worker not found: {0}")]
    WorkerNotFound(WorkerId),

    #[error("Internal error: {0}")]
    Internal(String),
}

/// Scheduler port
#[async_trait]
pub trait SchedulerPort: Send + Sync {
    async fn register_worker(&self, worker: Worker) -> Result<(), SchedulerError>;
    async fn unregister_worker(&self, worker_id: &WorkerId) -> Result<(), SchedulerError>;
    async fn get_registered_workers(&self) -> Result<Vec<WorkerId>, SchedulerError>;
}
```

---

## ðŸ§ª Test Plan

### Unit Tests
- [ ] Port is object-safe
- [ ] Error type implements Error trait
- [ ] Error type has Display trait
- [ ] Error variants are constructible

---

## ðŸ“Š Definition of Done

- [ ] Code complete and compiles without errors
- [ ] All unit tests pass (100% for this story)
- [ ] Port interface reviewed and approved
- [ ] Error handling reviewed and approved
- [ ] KDoc documentation complete
- [ ] No clippy warnings
- [ ] No compiler warnings
- [ ] Code follows project style guide

---

## ðŸ”— Dependencies

**Prerequisites**:
- None (foundational interface)

**Dependents**:
- US-08.1.2: WorkerRegistrationAdapter - Implements this port
- US-08.1.3: Wiring Dependencies - Uses this port

---

**Story Status**: ðŸ“‹ Ready for Development
