groups:
  - name: hodei.resource-pools
    rules:
      # Pool Health Alerts
      
      - alert: PoolProvisioningFailure
        expr: hodei_success_rate{operation="provisioning"} < 0.95
        for: 2m
        labels:
          severity: critical
          component: resource-pool
        annotations:
          summary: "Pool {{ $labels.pool_id }} provisioning success rate is low"
          description: "Pool {{ $labels.pool_id }} has been failing to provision workers. Success rate: {{ $value | humanizePercentage }} over the last 5 minutes."
          runbook_url: "https://docs.hodei.io/runbooks/provisioning-failures"
          
      - alert: PoolTerminationFailure
        expr: hodei_success_rate{operation="termination"} < 0.98
        for: 2m
        labels:
          severity: warning
          component: resource-pool
        annotations:
          summary: "Pool {{ $labels.pool_id }} termination success rate is low"
          description: "Pool {{ $labels.pool_id }} is failing to properly terminate workers. Success rate: {{ $value | humanizePercentage }}."
          
      - alert: PoolHighErrorRate
        expr: rate(hodei_job_counters{status="failed"}[5m]) / rate(hodei_job_counters[5m]) > 0.05
        for: 1m
        labels:
          severity: critical
          component: resource-pool
        annotations:
          summary: "Pool {{ $labels.pool_id }} error rate is high"
          description: "Pool {{ $labels.pool_id }} has an error rate of {{ $value | humanizePercentage }}."
          
      - alert: PoolCapacityExhausted
        expr: hodei_pool_size{type="current"} / hodei_pool_size{type="max"} > 0.95
        for: 5m
        labels:
          severity: warning
          component: resource-pool
        annotations:
          summary: "Pool {{ $labels.pool_id }} is near capacity"
          description: "Pool {{ $labels.pool_id }} is at {{ $value | humanizePercentage }} of maximum capacity."
          
      - alert: PoolNoAvailableWorkers
        expr: hodei_worker_states{state="available"} == 0
        for: 30s
        labels:
          severity: critical
          component: resource-pool
        annotations:
          summary: "Pool {{ $labels.pool_id }} has no available workers"
          description: "Pool {{ $labels.pool_id }} has 0 available workers. Jobs may be queued."

  - name: hodei.performance
    rules:
      # Performance Alerts
      
      - alert: HighAllocationLatency
        expr: hodei_allocation_latency > 1000
        for: 2m
        labels:
          severity: warning
          component: resource-pool
        annotations:
          summary: "High allocation latency on pool {{ $labels.pool_id }}"
          description: "Pool {{ $labels.pool_id }} is experiencing high allocation latency. P95: {{ $value }}ms."
          
      - alert: CriticalAllocationLatency
        expr: hodei_allocation_latency > 5000
        for: 1m
        labels:
          severity: critical
          component: resource-pool
        annotations:
          summary: "Critical allocation latency on pool {{ $labels.pool_id }}"
          description: "Pool {{ $labels.pool_id }} has critical allocation latency. P95: {{ $value }}ms."

  - name: hodei.cost
    rules:
      # Cost Alerts
      
      - alert: HighCostPerJob
        expr: hodei_cost_metrics{metric="cost_per_job"} > 1.00
        for: 5m
        labels:
          severity: warning
          component: resource-pool
        annotations:
          summary: "High cost per job on pool {{ $labels.pool_id }}"
          description: "Pool {{ $labels.pool_id }} is averaging ${{ $value }} per job."
          
      - alert: LowResourceUtilization
        expr: hodei_cost_metrics{metric="utilization"} < 0.5
        for: 15m
        labels:
          severity: info
          component: resource-pool
        annotations:
          summary: "Low resource utilization on pool {{ $labels.pool_id }}"
          description: "Pool {{ $labels.pool_id }} is only utilizing {{ $value | humanizePercentage }} of allocated resources."

  - name: hodei.quotas
    rules:
      # Quota Alerts
      
      - alert: TenantQuotaExceeded
        expr: hodei_tenant_quota_utilization > 1.0
        for: 1m
        labels:
          severity: warning
          component: quotas
        annotations:
          summary: "Tenant {{ $labels.tenant_id }} has exceeded quota"
          description: "Tenant {{ $labels.tenant_id }} has exceeded their quota by {{ $value | humanizePercentage }}."
          
      - alert: TenantQuotaNearLimit
        expr: hodei_tenant_quota_utilization > 0.9
        for: 5m
        labels:
          severity: warning
          component: quotas
        annotations:
          summary: "Tenant {{ $labels.tenant_id }} is approaching quota limit"
          description: "Tenant {{ $labels.tenant_id }} has used {{ $value | humanizePercentage }} of their quota."
          
      - alert: TenantHighCost
        expr: hodei_tenant_cost_today > 100
        for: 1m
        labels:
          severity: warning
          component: quotas
        annotations:
          summary: "Tenant {{ $labels.tenant_id }} high daily cost"
          description: "Tenant {{ $labels.tenant_id }} has accumulated ${{ $value }} in costs today."
          
      - alert: FairShareViolation
        expr: hodei_tenant_fair_share_weight < 0.1
        for: 10m
        labels:
          severity: warning
          component: quotas
        annotations:
          summary: "Tenant {{ $labels.tenant_id }} fairness score is low"
          description: "Tenant {{ $labels.tenant_id }} may be experiencing fairness issues. Weight: {{ $value }}."

  - name: hodei.sla
    rules:
      # SLA Violation Alerts
      
      - alert: SlaBreachCritical
        expr: hodei_sla_compliance < 0.95
        for: 30s
        labels:
          severity: critical
          component: sla
        annotations:
          summary: "Critical SLA breach on pool {{ $labels.pool_id }}"
          description: "Pool {{ $labels.pool_id }} is not meeting critical SLA requirements. Compliance: {{ $value | humanizePercentage }}."
          runbook_url: "https://docs.hodei.io/runbooks/sla-breaches"
          
      - alert: SlaBreachWarning
        expr: hodei_sla_compliance < 0.99
        for: 2m
        labels:
          severity: warning
          component: sla
        annotations:
          summary: "SLA warning on pool {{ $labels.pool_id }}"
          description: "Pool {{ $labels.pool_id }} is at risk of SLA breach. Compliance: {{ $value | humanizePercentage }}."

  - name: hodei.cluster
    rules:
      # Cluster-wide Alerts
      
      - alert: ClusterWideOutage
        expr: count(hodei_pool_size{type="current"} > 0) < 1
        for: 30s
        labels:
          severity: critical
          component: cluster
        annotations:
          summary: "No resource pools available"
          description: "No resource pools are currently available. All pools have zero capacity."
          runbook_url: "https://docs.hodei.io/runbooks/cluster-outage"
          
      - alert: MultiplePoolFailures
        expr: count(hodei_success_rate{operation="provisioning"} < 0.9) > 1
        for: 1m
        labels:
          severity: critical
          component: cluster
        annotations:
          summary: "Multiple pools experiencing failures"
          description: "{{ $value }} pools are experiencing provisioning failures."
